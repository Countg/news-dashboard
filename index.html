<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>News Dashboard</title>

  <!-- FAVICON -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ∞Ô∏è</text></svg>">

  <style>
    :root{
      --bg:#1e1b4b; --text:#f2f2ff; --muted:rgba(242,242,255,.70);
      --line:rgba(255,255,255,.12); --shadow:0 14px 40px rgba(0,0,0,.35);
      --radius:18px; --accent:#FF6719; --accentSoft:rgba(255,103,25,.18);
      --panel:rgba(255,255,255,.06); --panel2:rgba(255,255,255,.045);
      --btn:rgba(255,255,255,.08); --btnHover:rgba(255,255,255,.12);
      --good:rgba(80,220,140,.18); --bad:rgba(255,120,120,.16);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 0%, rgba(255,103,25,.12) 0%, rgba(255,103,25,0) 55%),
        radial-gradient(900px 700px at 85% 10%, rgba(255,255,255,.08) 0%, rgba(255,255,255,0) 55%),
        linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.35)),
        var(--bg);
      min-height:100vh;
    }
    header{padding:26px 22px 16px; max-width:1120px; margin:0 auto;}
    h1{margin:0 0 10px; font-size:28px; letter-spacing:.2px; display:inline-flex; gap:10px; align-items:baseline;}
    .brandMark{font-size:14px; padding:4px 10px; border-radius:999px; border:1px solid var(--line); background:var(--accentSoft);}
    .sub{color:var(--muted); font-size:14px; max-width:900px; line-height:1.35;}
    .statusBar{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:14px;}
    .pill{
      display:inline-flex; align-items:center; gap:10px;
      padding:9px 12px; border-radius:999px; border:1px solid var(--line);
      background:var(--panel); font-size:13px; box-shadow:0 10px 26px rgba(0,0,0,.18);
    }
    .pill.good{background:var(--good)} .pill.bad{background:var(--bad)}
    .wxCore{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}
    .wxSignal{
      width:66px; height:12px; border-radius:999px; border:1px solid var(--line);
      background:var(--panel2); overflow:hidden; position:relative;
    }
    .wxSignal::before{
      content:""; position:absolute; inset:0;
      background:linear-gradient(90deg, rgba(255,103,25,0) 0%, rgba(255,103,25,.65) 22%, rgba(255,103,25,.95) 50%, rgba(255,103,25,.65) 78%, rgba(255,103,25,0) 100%);
      transform:translateX(-80%); animation:sweep 2.2s linear infinite; opacity:.85;
    }
    @keyframes sweep{0%{transform:translateX(-80%)} 100%{transform:translateX(80%)}}
    .topbar{display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:14px;}
    input[type="search"]{
      flex:1; min-width:220px; padding:12px 14px; border-radius:999px; border:1px solid var(--line);
      background:rgba(255,255,255,.07); color:var(--text); outline:none;
    }
    input[type="search"]::placeholder{color:rgba(242,242,255,.55)}
    .btn{
      padding:10px 14px; border-radius:999px; border:1px solid var(--line);
      background:var(--btn); color:var(--text); cursor:pointer; user-select:none;
      box-shadow:0 10px 22px rgba(0,0,0,.18);
    }
    .btn:hover{background:var(--btnHover)}
    .btn.accent{border-color:rgba(255,103,25,.55); background:rgba(255,103,25,.16)}
    .btn.accent:hover{background:rgba(255,103,25,.22)}
    main{max-width:1120px; margin:0 auto; padding:0 22px 34px; display:grid; grid-template-columns:1fr; gap:14px;}
    @media (min-width:860px){ main{grid-template-columns:2fr 1fr; gap:16px;} }
    .card{
      background:rgba(255,255,255,.05); border:1px solid var(--line); border-radius:var(--radius);
      box-shadow:var(--shadow); overflow:hidden; backdrop-filter:blur(6px);
    }
    .card h2{margin:0; padding:14px 16px; font-size:16px; border-bottom:1px solid var(--line); display:flex; justify-content:space-between; align-items:center; gap:12px;}
    .meta{color:var(--muted); font-weight:600; font-size:12px;}
    .grid{display:grid; grid-template-columns:1fr; gap:10px; padding:14px 16px 16px;}
    @media (min-width:620px){ .grid{grid-template-columns:1fr 1fr;} }
    .labelRow{display:flex; align-items:center; justify-content:space-between; gap:10px; margin:0 0 10px;}
    .label{font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.12em; margin:0;}
    .sectionActions{display:flex; gap:8px; flex-wrap:wrap;}
    .miniBtn{
      padding:6px 10px; border-radius:999px; border:1px solid var(--line);
      background:rgba(255,255,255,.07); color:var(--text); cursor:pointer; font-size:12px;
    }
    .miniBtn:hover{background:rgba(255,255,255,.11)}
    .links a{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      padding:10px 12px; margin:8px 0; text-decoration:none; color:var(--text);
      background:rgba(0,0,0,.10); border:1px solid var(--line); border-radius:12px;
      transition:transform .08s ease, background .2s ease, border-color .2s ease;
    }
    .links a:hover{transform:translateY(-1px); background:rgba(0,0,0,.16); border-color:rgba(255,103,25,.35)}
    .chip{font-size:12px; color:rgba(242,242,255,.72); background:rgba(255,255,255,.07); border:1px solid var(--line); padding:3px 8px; border-radius:999px; white-space:nowrap;}
    textarea{
      width:100%; min-height:220px; resize:vertical; padding:12px; border-radius:12px; border:1px solid var(--line);
      background:rgba(0,0,0,.12); color:var(--text); outline:none; font-size:14px; line-height:1.5;
    }
    textarea::placeholder{color:rgba(242,242,255,.52)}
    .small{font-size:12px; color:var(--muted); padding:0 16px 16px; margin-top:-6px; line-height:1.35;}
    .hidden{display:none !important;}
    .mood{
      display:inline-flex; gap:8px; align-items:baseline; margin-left:6px;
      padding:3px 10px; border-radius:999px; border:1px solid rgba(255,103,25,.45);
      background:rgba(255,103,25,.12); font-size:12px; white-space:nowrap;
    }
    .mood b{color:var(--accent); font-weight:700;}
    .saveRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; align-items:center;}
    .saveStatus{color:rgba(242,242,255,.70); font-size:12px;}
  </style>
</head>

<body>
  <header>
    <h1>News Dashboard <span class="brandMark">lo-fi control room</span></h1>
    <div class="sub">
      Your pinned source board + a scratchpad. Date/time updates automatically. Weather/location works when you allow it.
      <span class="mood" id="moodPill" title="Weather-generated vibe report">mood: <b>unknown</b></span>
    </div>

    <div class="statusBar">
      <div class="pill" id="datePill">üìÖ <span id="dateText">Loading date‚Ä¶</span></div>
      <div class="pill" id="locPill">üìç <span id="locText">Location: not set</span></div>
      <div class="pill" id="wxPill">
        <div class="wxCore">üå§Ô∏è <span id="wxText">Weather: not loaded</span> <span class="wxSignal" aria-hidden="true"></span></div>
      </div>
      <div class="pill" id="sunPill">üåÖ <span id="sunText">Sun: not loaded</span></div>

      <button class="btn accent" id="getWeather">Get my weather</button>
      <button class="btn" id="refreshWeather">Refresh</button>
    </div>

    <div class="topbar">
      <input id="q" type="search" placeholder="Filter sources (e.g., 'Hamilton', 'horror', 'tech')" />
      <button class="btn" id="reset">Reset</button>
      <button class="btn" id="focus">Focus mode</button>
    </div>
  </header>

  <main>
    <section class="card" id="sources">
      <h2>Sources <span class="meta" id="count"></span></h2>

      <div class="grid">
        <div class="section" data-section="local-hamilton">
          <div class="labelRow">
            <p class="label">Local Hamilton</p>
            <div class="sectionActions"><button class="miniBtn openAll" data-open="local-hamilton">Open all</button></div>
          </div>
          <div class="links">
            <a href="https://www.cbc.ca/news/canada/hamilton" target="_blank" rel="noopener">CBC Hamilton <span class="chip">local</span></a>
            <a href="https://www.thespec.com/" target="_blank" rel="noopener">Hamilton Spectator <span class="chip">local</span></a>
            <a href="https://www.chch.com/" target="_blank" rel="noopener">CHCH News <span class="chip">local</span></a>
          </div>
        </div>

        <div class="section" data-section="canada-indie">
          <div class="labelRow">
            <p class="label">Canada / Indie + Accountability</p>
            <div class="sectionActions"><button class="miniBtn openAll" data-open="canada-indie">Open all</button></div>
          </div>
          <div class="links">
            <a href="https://www.cbc.ca/news" target="_blank" rel="noopener">CBC News <span class="chip">canada</span></a>
            <a href="https://www.thecanadianpressnews.ca/" target="_blank" rel="noopener">The Maple <span class="chip">left</span></a>
            <a href="https://thetyee.ca/" target="_blank" rel="noopener">The Tyee <span class="chip">investigations</span></a>
            <a href="https://thenarwhal.ca/" target="_blank" rel="noopener">The Narwhal <span class="chip">climate</span></a>
            <a href="https://rabble.ca/" target="_blank" rel="noopener">Rabble <span class="chip">analysis</span></a>
          </div>
        </div>

        <div class="section" data-section="aggregation">
          <div class="labelRow">
            <p class="label">Aggregation</p>
            <div class="sectionActions"><button class="miniBtn openAll" data-open="aggregation">Open all</button></div>
          </div>
          <div class="links">
            <a href="https://ground.news/" target="_blank" rel="noopener">Ground News <span class="chip">bias-map</span></a>
          </div>
        </div>

        <div class="section" data-section="tech">
          <div class="labelRow">
            <p class="label">Tech / Culture</p>
            <div class="sectionActions"><button class="miniBtn openAll" data-open="tech">Open all</button></div>
          </div>
          <div class="links">
            <a href="https://www.404media.co/" target="_blank" rel="noopener">404 Media <span class="chip">power</span></a>
            <a href="https://www.theverge.com/" target="_blank" rel="noopener">The Verge <span class="chip">tech</span></a>
          </div>
        </div>

        <div class="section" data-section="movies-comics">
          <div class="labelRow">
            <p class="label">Movies + Comic Books</p>
            <div class="sectionActions"><button class="miniBtn openAll" data-open="movies-comics">Open all</button></div>
          </div>
          <div class="links">
            <a href="https://bloody-disgusting.com/" target="_blank" rel="noopener">Bloody Disgusting <span class="chip">horror</span></a>
            <a href="https://www.cbr.com/" target="_blank" rel="noopener">CBR <span class="chip">comics</span></a>
          </div>
        </div>

      </div>
    </section>

    <aside class="card" id="today">
      <h2>Scratchpad <span class="meta">autosaves + Google log</span></h2>
      <div style="padding:14px 16px 10px;">
        <textarea id="pad" placeholder="Drop headlines, links, notes‚Ä¶"></textarea>
        <input id="tags" type="text" placeholder="Tags (e.g., LOCAL, TECH, HORROR, BIT)" style="
  width:100%;
  margin-top:10px;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(0,0,0,.12);
  color:#f2f2ff;
  outline:none;
">

        <div class="saveRow">
          <button class="btn accent" id="saveToGoogle">Save to Google</button>
          <button class="btn" id="openForm">Open Form</button>
          <button class="btn" id="openResponses">Open Responses Sheet</button>
          <span class="saveStatus" id="saveStatus"></span>
        </div>

        <!-- hidden iframe for silent submit -->
        <iframe name="hidden_iframe" style="display:none;"></iframe>
      </div>
      <div class="small">
        Tags: <b>[LOCAL]</b> <b>[CAN]</b> <b>[CLIMATE]</b> <b>[TECH]</b> <b>[HORROR]</b> <b>[COMICS]</b> <b>[BIT]</b>
      </div>
    </aside>
  </main>

  <script>


    // =========================
    // FILTER + UI
    // =========================
    const q = document.getElementById('q');
    const reset = document.getElementById('reset');
    const focus = document.getElementById('focus');
    const today = document.getElementById('today');
    const links = Array.from(document.querySelectorAll('.links a'));
    const count = document.getElementById('count');

    function updateCount(){
      const visible = links.filter(a => !a.classList.contains('hidden')).length;
      count.textContent = `${visible}/${links.length} links`;
    }
    function filter(){
      const term = q.value.trim().toLowerCase();
      links.forEach(a => {
        const text = a.textContent.toLowerCase();
        a.classList.toggle('hidden', term && !text.includes(term));
      });
      updateCount();
    }
    q.addEventListener('input', filter);
    reset.addEventListener('click', () => { q.value = ''; filter(); q.focus(); });

    let focused = false;
    focus.addEventListener('click', () => {
      focused = !focused;
      today.style.display = focused ? 'none' : '';
      focus.textContent = focused ? 'Unfocus' : 'Focus mode';
    });

    // Open all links in a section
    document.querySelectorAll('.openAll').forEach(btn => {
      btn.addEventListener('click', () => {
        const sectionName = btn.getAttribute('data-open');
        const section = document.querySelector(`[data-section="${sectionName}"]`);
        const sectionLinks = Array.from(section.querySelectorAll('a'));
        sectionLinks.forEach((a, i) => setTimeout(() => window.open(a.href, "_blank", "noopener"), i * 120));
      });
    });

    // =========================
    // DATE/TIME
    // =========================
    const dateText = document.getElementById('dateText');
    function updateDateTime(){
      const now = new Date();
      dateText.textContent = now.toLocaleString(undefined, {
        weekday:"short", year:"numeric", month:"short", day:"numeric", hour:"2-digit", minute:"2-digit"
      });
    }
    updateDateTime();
    setInterval(updateDateTime, 15000);

    // =========================
    // WEATHER + LOCATION
    // =========================
    const locText = document.getElementById('locText');
    const wxText = document.getElementById('wxText');
    const sunText = document.getElementById('sunText');
    const locPill = document.getElementById('locPill');
    const wxPill = document.getElementById('wxPill');
    const sunPill = document.getElementById('sunPill');
    const getWeatherBtn = document.getElementById('getWeather');
    const refreshWeatherBtn = document.getElementById('refreshWeather');
    const moodPill = document.getElementById('moodPill');

    const GEO_KEY='news_dashboard_geo_v1', WX_KEY='news_dashboard_wx_v1';
    const GEO_TTL_MS=6*60*60*1000, WX_TTL_MS=30*60*1000;

    function pillState(el, state){
      el.classList.remove("good","bad");
      if (state==="good") el.classList.add("good");
      if (state==="bad") el.classList.add("bad");
    }
    function setMood(label){ moodPill.innerHTML = `mood: <b>${label}</b>`; }

    function weatherCodeToText(code){
      const map = {0:"Clear",1:"Mainly clear",2:"Partly cloudy",3:"Overcast",45:"Fog",48:"Rime fog",
        51:"Light drizzle",53:"Drizzle",55:"Heavy drizzle",61:"Light rain",63:"Rain",65:"Heavy rain",
        71:"Light snow",73:"Snow",75:"Heavy snow",80:"Rain showers",81:"Showers",82:"Violent showers",
        95:"Thunderstorm",96:"Thunderstorm + hail",99:"Thunderstorm + heavy hail"};
      return map[code] || `Weather code ${code}`;
    }
    function moodFromCode(code){
      if(code===0) return "clear skies, suspiciously optimistic";
      if(code===1||code===2) return "decent vibes, still capitalism";
      if(code===3) return "overcast: the universe is buffering";
      if(code===45||code===48) return "fog: reality‚Äôs soft-launch";
      if([51,53,55].includes(code)) return "drizzle: mild inconvenience doctrine";
      if([61,63,65].includes(code)) return "rain: ambient existential percussion";
      if([71,73,75].includes(code)) return "snow: silence with consequences";
      if([80,81,82].includes(code)) return "showers: chaos doing cardio";
      if([95,96,99].includes(code)) return "thunder: the gods are subtweeting";
      return "uncategorized weather: interpretive dance";
    }

    async function reverseGeocodeOpenMeteo(lat, lon){
      const url = `https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&language=en&format=json`;
      const r = await fetch(url);
      if(!r.ok) throw new Error("Reverse geocode failed");
      const data = await r.json();
      const best = data?.results?.[0];
      if(!best) return `Lat ${lat.toFixed(3)}, Lon ${lon.toFixed(3)}`;
      const parts = [];
      if(best.name) parts.push(best.name);
      if(best.admin1) parts.push(best.admin1);
      if(best.country_code) parts.push(best.country_code);
      return parts.join(", ");
    }

    async function fetchWeather(lat, lon){
      const url =
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}` +
        `&current=temperature_2m,weather_code,wind_speed_10m&daily=sunrise,sunset` +
        `&temperature_unit=celsius&wind_speed_unit=kmh&timezone=auto`;
      const r = await fetch(url);
      if(!r.ok) throw new Error("Weather request failed");
      return await r.json();
    }

    function formatTime(iso){ return new Date(iso).toLocaleTimeString(undefined,{hour:"2-digit",minute:"2-digit"}); }

    function applyWeatherUI(payload){
      const temp = payload.current.temperature_2m;
      const wind = payload.current.wind_speed_10m;
      const code = payload.current.weather_code;
      const desc = weatherCodeToText(code);

      wxText.textContent = `Weather: ${temp}¬∞C ‚Ä¢ ${desc} ‚Ä¢ Wind ${wind} km/h`;
      pillState(wxPill, "good");

      const sunrise = payload.daily?.sunrise?.[0];
      const sunset  = payload.daily?.sunset?.[0];
      if (sunrise && sunset){
        sunText.textContent = `Sun: ‚Üë ${formatTime(sunrise)} ‚Ä¢ ‚Üì ${formatTime(sunset)}`;
        pillState(sunPill, "good");
      } else {
        sunText.textContent = "Sun: not available";
        pillState(sunPill, "bad");
      }

      setMood(moodFromCode(code));
    }

    function loadCachedGeo(){
      try{
        const g = JSON.parse(localStorage.getItem(GEO_KEY) || "null");
        if(!g) return null;
        if(Date.now() - g.ts > GEO_TTL_MS) return null;
        return g;
      }catch{ return null; }
    }
    function saveGeo(lat, lon){ localStorage.setItem(GEO_KEY, JSON.stringify({lat, lon, ts:Date.now()})); }

    function loadCachedWeather(){
      try{
        const w = JSON.parse(localStorage.getItem(WX_KEY) || "null");
        if(!w) return false;
        if(Date.now() - w.ts > WX_TTL_MS) return false;
        wxText.textContent = w.wxText;
        sunText.textContent = w.sunText;
        setMood(w.mood || "cached vibes");
        pillState(wxPill, "good"); pillState(sunPill, "good");
        return true;
      }catch{ return false; }
    }
    function saveCachedWeather(){
      localStorage.setItem(WX_KEY, JSON.stringify({
        ts: Date.now(),
        wxText: wxText.textContent,
        sunText: sunText.textContent,
        mood: moodPill.textContent.replace("mood:", "").trim()
      }));
    }

    async function updateFromCoords(lat, lon){
      try{
        const name = await reverseGeocodeOpenMeteo(lat, lon);
        locText.textContent = `Location: ${name}`;
        pillState(locPill,"good");
      }catch{
        locText.textContent = `Location: Lat ${lat.toFixed(3)}, Lon ${lon.toFixed(3)}`;
        pillState(locPill,"bad");
      }

      wxText.textContent = "Weather: fetching‚Ä¶";
      sunText.textContent = "Sun: fetching‚Ä¶";
      pillState(wxPill,"good"); pillState(sunPill,"good");

      try{
        const payload = await fetchWeather(lat, lon);
        applyWeatherUI(payload);
        saveCachedWeather();
      }catch{
        wxText.textContent = "Weather: failed to load";
        sunText.textContent = "Sun: failed to load";
        pillState(wxPill,"bad"); pillState(sunPill,"bad");
        setMood("api vibes: rejected");
      }
    }

    async function getLocationAndWeatherPrompt(){
      if(!navigator.geolocation){
        locText.textContent = "Location: not supported";
        pillState(locPill,"bad");
        wxText.textContent = "Weather: not available";
        sunText.textContent = "Sun: not available";
        pillState(wxPill,"bad"); pillState(sunPill,"bad");
        setMood("no geolocation: vibes undefined");
        return;
      }

      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude, lon = pos.coords.longitude;
        saveGeo(lat, lon);
        await updateFromCoords(lat, lon);
      }, () => {
        locText.textContent = "Location: blocked or unavailable";
        pillState(locPill,"bad");
        wxText.textContent = "Weather: needs location permission";
        sunText.textContent = "Sun: needs location permission";
        pillState(wxPill,"bad"); pillState(sunPill,"bad");
        setMood("permission denied: classic human move");
      }, { enableHighAccuracy:false, timeout:9000, maximumAge:300000 });
    }

    getWeatherBtn.addEventListener('click', getLocationAndWeatherPrompt);
    refreshWeatherBtn.addEventListener('click', async () => {
      const g = loadCachedGeo();
      if(!g) return getLocationAndWeatherPrompt();
      await updateFromCoords(g.lat, g.lon);
    });

    // On load: show cached stuff if present
    updateCount();
    const hadWeather = loadCachedWeather();
    const g = loadCachedGeo();
    if (g){
      (async () => {
        try{
          const name = await reverseGeocodeOpenMeteo(g.lat, g.lon);
          locText.textContent = `Location: ${name}`;
          pillState(locPill,"good");
        }catch{
          locText.textContent = `Location: Lat ${g.lat.toFixed(3)}, Lon ${g.lon.toFixed(3)}`;
          pillState(locPill,"bad");
        }
        // If weather cache stale, refresh silently (no prompt)
        const cached = JSON.parse(localStorage.getItem(WX_KEY) || "null");
        const stale = !cached || (Date.now() - cached.ts > WX_TTL_MS);
        if (stale) await updateFromCoords(g.lat, g.lon);
        else if (!hadWeather) loadCachedWeather();
      })();
    } else {
      setMood("unknown: please locate the meat suit");
      pillState(locPill,"bad");
    }

    // =========================
    // SCRATCHPAD (LOCAL SAVE + GOOGLE FORM SUBMIT)
    // =========================
    const pad = document.getElementById('pad');
    const saveStatus = document.getElementById('saveStatus');
    const saveToGoogleBtn = document.getElementById('saveToGoogle');
    const openFormBtn = document.getElementById('openForm');
    const openResponsesBtn = document.getElementById('openResponses');

    // Local autosave
    const PAD_KEY = 'news_dashboard_pad_v4';
    pad.value = localStorage.getItem(PAD_KEY) || '';
    pad.addEventListener('input', () => localStorage.setItem(PAD_KEY, pad.value));

    

    openFormBtn.addEventListener('click', () => window.open(GOOGLE_FORM_VIEW_URL, "_blank", "noopener"));

    openResponsesBtn.addEventListener('click', () => {
      if (!GOOGLE_RESPONSES_SHEET_URL || GOOGLE_RESPONSES_SHEET_URL.includes("PASTE_")){
        alert("Paste your Responses Sheet URL into GOOGLE_RESPONSES_SHEET_URL first.");
        return;
      }
      window.open(GOOGLE_RESPONSES_SHEET_URL, "_blank", "noopener");
    });

    function nowStamp(){
      return new Date().toLocaleString(undefined, {
        year:"numeric", month:"short", day:"2-digit", hour:"2-digit", minute:"2-digit"
      });
    }

        // =========================
    // GOOGLE FORM SETUP (YOU PROVIDED THESE)
    // =========================
const GOOGLE_FORM_VIEW_URL =
  "https://docs.google.com/forms/d/e/1FAIpQLSf-IQVRs31cxHjA_5LVIogmjEYuJg-G4p_pWzOZrAzx-sh5jA/viewform";

const GOOGLE_ENTRY_NOTE = "1595342700";
const GOOGLE_ENTRY_TAGS = "1912444628";

    // If you have (or later create) a Responses Sheet, put its URL here.
    // In Forms: Responses tab ‚Üí "View in Sheets" ‚Üí copy that URL.
    const GOOGLE_RESPONSES_SHEET_URL = "https://docs.google.com/spreadsheets/d/1SW5Ra36eUJYd3GWiPr08KbK08q9DR5TSbZh3gkrncX4/edit?usp=sharing";
    


function buildFormResponseUrl(noteText, tagsText){
  // Converts /viewform to /formResponse for submission
  const formResponseBase = GOOGLE_FORM_VIEW_URL.replace("/viewform", "/formResponse");

  const params = new URLSearchParams();
  params.set(`entry.${GOOGLE_ENTRY_NOTE}`, noteText);
  params.set(`entry.${GOOGLE_ENTRY_TAGS}`, tagsText || "");
  params.set("submit", "Submit");

  return `${formResponseBase}?${params.toString()}`;
}
saveToGoogleBtn.addEventListener('click', () => {
  const text = pad.value.trim();
  const tagsEl = document.getElementById("tags");
  const tags = (tagsEl?.value || "").trim();

  if (!text){
    saveStatus.textContent = "Nothing to save.";
    return;
  }

  saveStatus.textContent = "Submitting‚Ä¶";

  const payload = `[${nowStamp()}] ${text}`;

  try{
    const url = buildFormResponseUrl(payload, tags);

    const w = window.open(url, "_blank", "noopener,noreferrer");
    setTimeout(() => { if (w) w.close(); }, 900);

    saveStatus.textContent = "Saved to Google ‚úî";

    // ‚úÖ Clear the scratchpad + tags
    pad.value = "";
    if (tagsEl) tagsEl.value = "";

    // ‚úÖ Clear the autosaved local storage version too
    localStorage.setItem(PAD_KEY, "");

  } catch (e){
    saveStatus.textContent = "Save failed ‚Äî check form settings or IDs.";
  }
});


  </script>
</body>
</html>
